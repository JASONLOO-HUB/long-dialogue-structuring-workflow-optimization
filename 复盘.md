# 迭代日志与复盘总结

## 项目局限

测试数据集不够大，涵盖的对话情境不够全面。因为时间关系，只选取了一段长对话进行测试调优。也没有具体计算各项测试指标。如果日后时间充足，可以选取更多数据集进行测试，并量化调优结果。

---

## 迭代日志

###Ver.1

总体流程：
    1. **抓取:** 将pdf总结为带有层级关系的JSON，合并同类话题，将子话题归纳入父话题。（避免结构过于臃肿）
    2. **辨认:** 过滤被否决的方案，标记没有被讨论的方案，输出带细节的总结文档。

---

### Ver.2

**总体流程**
    1. **清洗:** 将pdf清洗为带时序的text文档。将行号嵌入到每一行文本。（行号的大小代表着对话发生的先后次序，减少幻觉和时序识别错误）
    2. **抓取:** 将pdf总结为带有层级关系的JSON，合并同类话题，将子话题归纳入父话题。（避免结构过于臃肿，避免时序相差过大的话题无法准确进行否定判定）
    3. **辨认:** 过滤被否决的方案，标记没有被讨论的方案，输出带细节的总结文档。

**改进思路**
    1. **清洗** 将需要视觉处理的pdf转化为嵌入时间先后关系的text，时序越大代表越接近结论，方便否定判定。同时嵌入时序，可以直接通过时序索引全文，减少幻觉。
    2. **抓取** 精细化话题分级的prompt，引入具体的归类步骤、颗粒度和无关话题识别，提供更详细的话题判断归类例子。
    3. **辨认** 按照JSON的大纲，逐个标记话题，并再次逐个总结话题，根据标签决定总结与否；提供更加详细的FEW SHOT。

**缺陷**
    1. 调用Gemini2.0flash2分钟后继续请求失败，最终Output不完整，但我当时没有意识到工作流任务过重，导致处理时间过长。
    2. 最终Output包含过多判定过程，过于啰嗦，稀释重点。

---

### Ver.3

**总体流程**
    1. **清洗:** 将pdf清洗为带时序的text文档。将行号嵌入到每一行文本。（行号的大小代表着对话发生的先后次序，减少幻觉和时序识别错误）
    2. **抓取:** 将pdf总结为带有层级关系的JSON，合并同类话题，将子话题归纳入父话题。
    3. **辨认:** 过滤被否决的方案，标记没有被讨论的方案，输出带细节的总结文档。

**改进思路**
    1. **辨认** 精细文档生成原则
    ```
    1. **Re-structure (重构):** 不要按时间线罗列。不要叙事，不要写推理、讨论、迭代的过程直接写结论。
    * *Bad:* "对于某功能，用户先说了A，然后AI说了A有问题并提出了B，最后用户提出采用A结合B"
    * *Good:* "某功能采用A结合B的解决方案"
    2. **Terminology (术语升维):** 将口语转化为专业术语。
    * "问到底" -> "深度钻研 (Deep-dive)"
    * "很多个窗口" -> "多维画布 (Canvas-based UI)"
    * "记住以前说的话" -> "上下文语义索引 (Contextual Semantic Indexing)"
    3. **Visual Structure (视觉结构):** 使用由浅入深的列表。
    * 使用 **加粗小标题** 引导阅读。
    * 对于 Open/TBD 的问题，归纳为“下一步行动”或“风险挑战”。
    4. **Silence the Noise (去噪):** 移除所有的行号引用（[L10-L20]）和状态标记（ACCEPTED），只保留事实本身。
    ```

**缺陷**
1. 调用Gemini2.5pro3分钟后继续请求失败，最终没有Output

---

### Ver.4

**总体流程**
    1. **清洗:** 将pdf清洗为带时序的text文档。将行号嵌入到每一行文本。
    2. **抓取:** 将pdf总结为带有层级关系的JSON，合并同类话题，将子话题归纳入父话题。
    3. **拆分** 将JSON按照话题切分为若干个JSON文件。
    4. **辨认:** 逐个处理切分后的JSON文件。基于索引回溯原文，审计每个方案的最终状态（是否被否决，或默认否决）。
    5. **辨认** 将清洗后的事实组装为Markdown报告。

**改进思路**
    1. **拆分** 将任务拆分为若干模块，减少单次任务上下文。
    2. **辨认** 精简prompt的FEW SHOT
    3. **辨认** 删除先逐条便签，再逐条检索标签，判断是否写入总结的指令。放弃打标签，改为文档生成过程中的constrain：
        ‘’‘
        # 文档生成原则
        1.  **不要按时间线罗列。不要叙事，不要写推理、讨论、迭代的过程直接写结论：** 
            * *Bad:* "对于某功能，用户先说了A，然后AI说了A有问题并提出了B，最后用户提出采用A结合B"
            * *Good:* "某功能采用A结合B的解决方案"
        2.  **将口语转化为专业术语：** 
            * "记住以前说的话" -> "上下文语义索引 (Contextual Semantic Indexing)"
        3.  **使用由浅入深的列表：** 
            * 使用 **加粗小标题** 引导阅读。
            * 对于 Open/TBD 的问题，归纳为“下一步行动”或“风险挑战”。
        4.  **[Ln]代表时序，n的值越大，对话发生事件越靠后）** 
        ’‘’